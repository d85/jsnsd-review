# JSNSD Review

### Execute node command from terminal

```sh
node -e "fs.mkdirSync('http-web-server')"
```

The `app.use` method takes a function which is called for every incoming request, and it will be passed a request object and a response object.

app.js
```js
'use strict'
const express = require('express')
const createError = require('http-errors')
const indexRoutes = require('./routes')
const helloRoutes = require('./routes/hello')

const app = express()

app.use('/', indexRoutes)
app.use('/hello', helloRoutes)

app.use((req, res, next) => {
  if (req.method !== 'GET') {
    next(createError(405))
    return
  }
  next(createError(404))
})

app.use((err, req, res, next) => {
  res.status(err.status || 500)
  res.send(err.message)
})

module.exports = app
```

routes/index.js
```js
'use strict'
const { Router } = require('express')
const router = Router()

const root = `<html>
  <head>
    <style>
      body { background: #333; margin: 1.25rem }
      a { color: yellow; font-size: 2rem; font-family: sans-serif }
    </style>
  </head>
  <body>
    <a href='/hello'>Hello</a>
  </body>
</html>
`

router.get('/', (req, res) => {
  res.send(root)
})

module.exports = router
```

routes/hello.js
```js
'use strict'
const { Router } = require('express')
const router = Router()

const hello = `<html>
  <head>
    <style>
      body { background: #333; margin: 1.25rem }
      h1 { color: #EEE; font-family: sans-serif }
    </style>
  </head>
  <body>
    <h1>Hello World</h1>
  </body>
</html>`

router.get('/', (req, res) => {
  res.send(hello)
})

module.exports = router
```

Does the request match the / GET route?

Does the request match the /hello GET route?

Is it not a GET - create 405 (method not allowed) and send to next middleware

Else no route matched - create 404 (not found) and send to next middleware

Last middleware sets the error in the response

If the `next` function is not called, then the request handling ends there and none of the ensuing registered functions are called for that request.

If an object is passed to `res.send` that object would be serialized to JSON and the response Content-Type would automatically be set to `application/json`.

Even thought the `req` and `res` objects are generated by the `http` module and have all the of the same functionality, Express decorates the `req` and `res` objects with additional functionality.

Note however - by conflating Node core APIs with Express APIs on the same objects the principle of lease surprise and separation concerns are violated, while also causing performance issues.